# NebulaVPN (RU)

> [!WARNING] 
> ⚠️ ВАЖНОЕ ПРЕДУПРЕЖДЕНИЕ \
> Этот проект находится в активной разработке и тестировании. \
> Данное программное обеспечение предназначено ТОЛЬКО ДЛЯ ТЕСТИРОВАНИЯ И ОБРАЗОВАТЕЛЬНЫХ ЦЕЛЕЙ. \
> Не используйте в производственных средах или для критически важных операций.

Экспериментальный VPN-проект для отработки туннелирования, шифрования и маскировки TLS/HTTPS. Код не **готов к продакшену** — используйте только для обучения и тестов.

## Как это работает

NebulaVPN реализует безопасный прокси-туннель со следующей архитектурой:

### Основные компоненты

1. **SOCKS5 Клиент** - Локальный прокси, принимающий соединения от приложений
2. **Слой шифрования** - Шифрует весь трафик с использованием сильных шифров (AES-256-GCM или ChaCha20-Poly1305)
3. **TLS Транспорт** - Оборачивает зашифрованный трафик в TLS с опциональной HTTPS-маскировкой
4. **VPN Сервер** - Принимает зашифрованный трафик, расшифровывает его и перенаправляет на целевые назначения

### Протокол работы

```
Приложение → SOCKS5 Клиент → Шифрование → TLS/HTTPS Маска → VPN Сервер → Расшифрование → Целевой Интернет
```

### Детальный процесс

1. **Настройка клиента**
   - Запускает локальный SOCKS5 прокси на настроенном порту (по умолчанию: 1080)
   - Подключается к VPN-серверу через TLS с проверкой сертификата
   - Опциональная HTTPS-маскировка маскирует трафик под легитимные HTTPS-запросы

2. **Обработка соединений**
   - Приложение подключается к локальному SOCKS5 прокси
   - Клиент проверяет протокол SOCKS5 и извлекает целевой адрес
   - Целевой адрес шифруется с использованием ключей, полученных через PBKDF2, и случайных солей

3. **Шифрование трафика**
   - Каждый пакет получает уникальную 32-байтную соль для обеспечения секретности
   - Используется 100,000 итераций PBKDF2 для вывода ключей
   - Поддерживаются шифры AES-256-GCM и ChaCha20-Poly1305
   - 12-байтные нонсы обеспечивают криптографическую безопасность

4. **TLS транспортный слой**
   - Обеспечивает TLS 1.2+ только с сильными наборами шифров
   - Опциональная HTTP-маскировка отправляет поддельные HTTP-запросы для маскировки трафика
   - Рандомизированные User-Agent и HTTP-методы для лучшей обфускации

5. **Обработка на сервере**
   - Проверяет сертификаты клиентов и опциональные IP-белые списки
   - Расшифровывает пакеты с использованием извлечённых солей и выведенных ключей
   - Перенаправляет трафик на реальные назначения с защитой от таймаутов
   - Реализует лимиты соединений и ограничение скорости

### Особенности безопасности

- **Сильное шифрование**: PBKDF2 вывод ключей с пакетными случайными солями
- **Идеальная прямая секретность**: Компрометация одного пакета не влияет на другие
- **TLS защита**: Вся связь между клиентом и сервером зашифрована современным TLS
- **Обфускация трафика**: Опциональная HTTPS-маскировка для обхода глубокой инспекции пакетов
- **Контроль доступа**: IP-белые списки и лимиты соединений на стороне сервера
- **Валидация ввода**: Комплексная проверка всех адресов и протоколов

### Оптимизации производительности

- **Пулинг буферов**: Использует буферы для снижения накладных расходов на сборку мусора
- **Параллельная обработка**: Эффективное управление горутинами с отменой контекста
- **Управление таймаутами**: Настраиваемые таймауты предотвращают истощение ресурсов
- **Эффективность памяти**: Оптимизированные структуры пакетов и стратегии копирования

## Возможности (сейчас)

- Клиент/сервер по схеме SOCKS5 с зашифрованным туннелем
- Подключаемые шифры: `aes-256-gcm`, `chacha20-poly1305`
- TLS-обёртка с опциональной HTTPS-маскировкой (поддельный HTTP-запрос при установке соединения)
- Лимиты соединений и IP-фильтрация на стороне сервера
- Комплексная конфигурация с безопасными настройками по умолчанию
- Структурированное логирование и возможности мониторинга

## Быстрый старт (тестирование)

1. Установите Go 1.20+.
2. `cd nebulavpn`
3. Запустите тесты: `go test ./...`
4. Скопируйте `config.yaml.example` в `config.yaml` и подправьте под локальные нужды.

### Пример использования

**Запуск сервера:**
```bash
./server -config config.yaml
```

**Запуск клиента:**
```bash
./client -config config.yaml
```

**Настройка приложения:**
Настройте ваше приложение использовать SOCKS5 прокси на `127.0.0.1:1080`

## Варианты конфигурации

### Настройки безопасности сервера
```yaml
server:
  max_connections: 1000        # Максимальное количество одновременных соединений
  timeout_seconds: 30         # Таймаут соединения
  allowed_ips:               # Опциональный белый список IP
    - "192.168.1.100"
```

### Настройки безопасности клиента
```yaml
client:
  timeout_seconds: 10         # Таймаут соединения
  retry_attempts: 3           # Попытки переподключения
  tls_skip_verify: false      # Проверка сертификата
```

### Настройки шифрования
```yaml
crypto:
  method: "chacha20-poly1305"  # или "aes-256-gcm"
  password: "сильный-пароль"     # Минимум 8 символов
```

### Маскировка трафика
```yaml
http_mask:
  enabled: true
  domain: "cloudflare.com"    # Маскировка под легитимный HTTPS
  user_agents:
    - "Mozilla/5.0 (Windows NT 10.0; Win64; x64)..."
```

## Статус проекта

- Работа в процессе; API и поведение могут меняться без обратной совместимости.
- Предназначен только для экспериментов и внутреннего тестирования, не для защиты реального трафика.
- Комплексное тестовое покрытие с валидацией безопасности
- Оптимизации производительности для сценариев с высокой пропускной способностью

## Участие

Issue и PR приветствуются. Пожалуйста, учитывайте экспериментальный характер проекта при предложении изменений.

### Рекомендации по разработке

- Следуйте лучшим практикам Go и стандартам безопасного кодирования
- Добавляйте комплексные тесты для новых возможностей
- Обновляйте документацию при изменениях протокола
- Обеспечивайте обратную совместимость, когда возможно

## Соображения безопасности

Это экспериментальный проект для образовательных целей. При использовании или изменении:

1. **Никогда не используйте в продакшене** - Этот код не прошёл аудит безопасности
2. **Поймите протокол** - Каждый компонент должен изучаться отдельно
3. **Тестируйте тщательно** - Используйте предоставленный набор тестов и добавляйте новые
4. **Мониторьте соединения** - Логируйте и отслеживайте все соединения при тестировании
5. **Храните ключи в безопасности** - Используйте сильные, уникальные пароли для тестов

## Диаграмма архитектуры

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Приложение   │    │  SOCKS5 Клиент  │    │  VPN Сервер   │
│               │────│                │────│                │
│ 127.0.0.1:1080│    │  Шифрование      │    │  :443 (TLS)   │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                                │
                                │
                       ┌─────────────────┐
                       │ Целевой Интернет │
                       │                │
                       └─────────────────┘
```

## Лицензия

MIT (см. `LICENSE`).
